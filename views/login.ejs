<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Crowdfunding Platform</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .card-custom {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.98);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .role-toggle {
      display: flex;
      background: #f3f4f6;
      border-radius: 50px;
      padding: 5px;
      margin-bottom: 30px;
    }
    .role-toggle button {
      flex: 1;
      padding: 12px 20px;
      border: none;
      background: transparent;
      border-radius: 50px;
      font-weight: 600;
      transition: all 0.3s ease;
      color: #6b7280;
    }
    .role-toggle button.active {
      background: white;
      color: #667eea;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .role-toggle button.investor.active {
      color: #10b981;
    }
    .role-toggle button.startup.active {
      color: #f59e0b;
    }
    .btn-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      transition: all 0.3s ease;
    }
    .btn-gradient:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }
    .form-control:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    .input-icon {
      position: relative;
    }
    .input-icon i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #667eea;
      z-index: 10;
    }
    .input-icon input {
      padding-left: 45px;
    }
  </style>
</head>
<body>
  <div class="container d-flex justify-content-center align-items-center min-vh-100 py-4">
    <div class="col-12 col-sm-10 col-md-8 col-lg-5 col-xl-4">
      <div class="card card-custom border-0">
        <div class="card-body p-4 p-md-5">
          <div class="text-center mb-4">
            <i class="fas fa-hand-holding-heart fa-3x mb-3" style="color: #667eea;"></i>
            <h2 class="fw-bold">Welcome Back</h2>
            <p class="text-muted">Login to your account</p>
          </div>

          <div id="message" class="alert d-none" role="alert"></div>

          <!-- Role Toggle -->
          <div class="role-toggle">
            <button type="button" class="investor active" data-role="investor">
              <i class="fas fa-briefcase me-2"></i>Investor
            </button>
            <button type="button" class="startup" data-role="startup_owner">
              <i class="fas fa-rocket me-2"></i>Startup Owner
            </button>
          </div>

          <form id="loginForm">
            <input type="hidden" id="role" value="investor">
            
            <div class="mb-3 input-icon">
              <i class="fas fa-envelope"></i>
              <input type="email" class="form-control form-control-lg" id="email" placeholder="Email Address" required>
            </div>

            <div class="mb-3 input-icon">
              <i class="fas fa-lock"></i>
              <input type="password" class="form-control form-control-lg" id="password" placeholder="Password" required>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="rememberMe">
                <label class="form-check-label small" for="rememberMe">
                  Remember me
                </label>
              </div>
              <a href="/forgot-password" class="text-decoration-none small" style="color: #667eea;">
                Forgot Password?
              </a>
            </div>

            <button type="submit" class="btn btn-gradient btn-lg w-100 text-white fw-bold mb-3" id="loginBtn">
              <i class="fas fa-sign-in-alt me-2"></i>Login
            </button>
          </form>

          <div class="text-center">
            <p class="mb-0">Don't have an account? 
              <a href="/register" class="text-decoration-none fw-bold" style="color: #667eea;">Register</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const roleButtons = document.querySelectorAll('.role-toggle button');
    const roleInput = document.getElementById('role');
    const form = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const messageDiv = document.getElementById('message');

    // Check for password reset success
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('reset') === 'success') {
      showMessage('Password reset successful. Please log in.', 'success');
    }

    roleButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        roleButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        roleInput.value = btn.dataset.role;
      });
    });

    function showMessage(message, type) {
      messageDiv.textContent = message;
      messageDiv.className = `alert alert-${type}`;
      messageDiv.classList.remove('d-none');
      setTimeout(() => messageDiv.classList.add('d-none'), 5000);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = {
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        role: roleInput.value
      };

      loginBtn.disabled = true;
      loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Logging in...';

      try {
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
          showMessage(data.message, 'success');
          localStorage.setItem('token', data.token);
          localStorage.setItem('user', JSON.stringify(data.user));
          
          if (document.getElementById('rememberMe').checked) {
            localStorage.setItem('rememberMe', 'true');
          }
          
          setTimeout(() => {
            if (data.user.role === 'investor') {
              window.location.href = '/investor/dashboard';
            } else if (data.user.role === 'startup_owner') {
              window.location.href = '/owner/dashboard';
            }
          }, 1500);
        } else {
          showMessage(data.message, 'danger');
          loginBtn.disabled = false;
          loginBtn.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i>Login';
        }
      } catch (error) {
        console.error('Error:', error);
        showMessage('Network error. Please try again.', 'danger');
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i>Login';
      }
    });
  </script>
</body>
</html>
